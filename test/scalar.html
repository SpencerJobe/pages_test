<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin:0px;
            padding:0px;
            box-sizing: border-box;
        }
        body {
            background:rgb(225,220,220);
            overscroll-behavior: none;
        }

        .screen-canvas {
            position:absolute;
            top:5%;
            height:44%;
            left:10%;
            width:80%;
            background:transparent;
            overflow: hidden;
            z-index: 501;
        }

        .screen-glass {
            position:absolute;
            z-index: 999;
            top:5%;
            height:44%;
            left:10%;
            right:10%;
            background:transparent;
            overflow: hidden;
            box-shadow: inset 0 0 14px 4px rgba(128, 128, 128, 0.59);
        }

        /*BEGIN directional-pad */
            .directional-pad {
                position: absolute;
                top:57%;
                left:0%;
                width:50%;
                height:30%;
                z-index: 9999px;
            }

            .directional-pad-up-down {
                position: absolute; 
                top:20%;
                bottom:20%;
                left:40%;
                width:20%;
                background:rgb(64,64,64);
            }

            .directional-pad-left-right {
                position: absolute; 
                top:40%;
                height:20%;
                left:20%;
                right:20%;
                background:rgb(64,64,64);
            }

        /*END*/

        .menu-button {
            position: absolute;
            top:93%;
            left:45%;
            width:15%;
            height:4.5%;
            background:rgb(64,64,64);
            border-radius: 12%;
        }
        .button-A {
            position:absolute;
            top:63%;
            left:75%;
            width:16%;
            height:9%;
            border-radius: 50%;
            background:rgb(128,30,50);
            text-align:center;
            font-size:190%;
            line-height:150%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color:rgb(64,15,25);
            overflow: hidden;
        }
        .button-B {
            position:absolute;
            top:73%;
            left:57%;
            width:16%;
            height:9%;
            border-radius: 50%;
            background:rgb(128,30,50);
            text-align:center;
            font-size:190%;
            line-height:150%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color:rgb(64,15,25);
            overflow: hidden;
        }

        .pixel {
            position:absolute;
            width:1%;
            height:1%;
            font-size:0px;
            overflow: hidden;
        }

        .c0 {
            background:rgb(178,188,138);
        }

        .c1 {
            background:rgb(140, 162, 121);
        }
        .c2 {
            background:rgb(92, 110, 86);
        }
        .c3 {
            background:rgb(73, 87, 68);
        }


    </style>
</head>
<body>
    <div id="versionNum" style="position:absolute; bottom:0px; right:0px; color:blue; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
        5
    </div>

    <canvas id="geScreenCanvas" class="screen-canvas" width=100 height=100> </canvas>
    <div id="geScreenGlass" class="screen-glass"> </div>

    <div id="geDPad" class="directional-pad">
        <div id="geDPadUpDown" class="directional-pad-up-down"></div>
        <div id="geDPadLeftRight" class="directional-pad-left-right"></div>
    </div>

    <div id="geButtonMenu" class="menu-button"> </div>
    <div id="geButtonA" class="button-A">A</div>
    <div id="geButtonB" class="button-B">B</div>
    
    <script>
        (function loadGameEngine(win) {


            //***********************************************************************************************
            //INTERNAL ENGINE COMPONENTS

                //GAME GLOBALS *************************

                    window.gSPRITES = {};
                    window.gSOUNDS = {};

                //END
                    
                //ENGINE GLOBALS *************************
                    var gGAME_LOOP_INTERVAL;
                    var gGAME_LOOP_FREQ = 16; //16 millisecs
                    var gCONTEXT_2D;
                    var gFRAME_TICK = 0;
                    var gTICK = 0;
                    var gFRAME_TICKS = [0,0,0,0,0,0,0,0,0,0];
                    var gKEY_DOWNS = {};
                    var gKEY_UPS = {};
                    var gBUTTON_DOWNS = {};
                    var gBUTTON_UPS = {};
                //END

                //GAME PALETTE *************************
                    var gGAME_PALETTE = [];
                    gGAME_PALETTE[0] = "rgb(178,188,138)";
                    gGAME_PALETTE[1] = "rgb(140,162,121)";
                    gGAME_PALETTE[2] = "rgb(92, 110, 86)";
                    gGAME_PALETTE[3] = "rgb(73, 87, 68)";
                //END

                //GAME FONT *************************
                    gGAME_FONT = {
                        "dither": "101010010101101010010101101010010101",
                        "0": "011100110010101010100110011100000000",
                        "1": "001000011000001000001000011100000000",
                        "2": "011100000010001110010000011110000000",
                        "3": "011110000010001100000010011100000000",
                        "4": "010010010010011110000010000010000000",
                        "5": "011110010000011100000010011100000000",
                        "6": "001110010000011110010010011110000000",
                        "7": "011110000010000100001000001000000000",
                        "8": "011110010010001100010010011110000000",
                        "9": "001110010010011110000010011100000000",
                        "a": "011100100010111110100010100010000000",
                        "b": "111100100010111100100010111110000000",
                        "c": "111110100000100000100000111110000000",
                        "d": "111100100010100010100010111100000000",
                        "e": "111110100000111100100000111110000000",
                        "f": "111110100000111100100000100000000000",
                        "g": "011110100000101110100010011100000000",
                        "h": "100010100010111110100010100010000000",
                        "i": "111110001000001000001000111110000000",
                        "j": "001110000100000100100100011000000000",
                        "k": "100010100100111000100100100010000000",
                        "l": "100000100000100000100000111110000000",
                        "m": "110110101010101010101010100010000000",
                        "n": "110010101010101010100110100010000000",
                        "o": "011100100010100010100010011100000000",
                        "p": "111100100010111110100000100000000000",
                        "q": "011100100010100010100100011010000000",
                        "r": "111100100010111100100010100010000000",
                        "s": "011110100000011100000010111100000000",
                        "t": "111110001000001000001000001000000000",
                        "u": "100010100010100010100010111110000000",
                        "v": "100010100010010100001000001000000000",
                        "w": "100010101010101010110110010100000000",
                        "x": "100010010100001000010100100010000000",
                        "y": "100010100010111110000010111110000000",
                        "z": "111110000100001000010000111110000000",
                        " ": "000000000000000000000000000000000000",
                        "?": "111000001000011000000000010000000000",
                        ".": "000000000000000000000000010000000000",
                        "!": "010000010000010000000000010000000000",
                        ",": "000000000000000000000000010000100000",
                        "'": "010000010000000000000000000000000000",
                        "@": "011100100010101110101010010110000000",
                        "#": "010100111110010100111110010100000000",
                        "$": "011110101000111110001010111110001000",
                        "%": "110010100100001000010010100110000000",
                        "^": "001000010100100010000000000000000000",
                        "&": "011000101000110010101100111000000000",
                        "*": "000000010100001000010100000000000000",
                        "(": "000100001000001000001000001000000100",
                        ")": "001000000100000100000100000100001000",
                        "-": "000000000000011110000000000000000000",
                        "=": "000000011110000000011110000000000000",
                        "_": "000000000000000000000000000000111111",
                        "+": "000000001000011100001000000000000000",
                        "[": "001100001000001000001000001000001100",
                        "]": "001100000100000100000100000100001100",
                        "{": "001100001000001000010000001000001100",
                        "}": "001100000100000100000010000100001100",
                        "/": "000000000010000100001000010000000000",
                        "\\": "000000010000001000000100000010000000",
                        "|": "001000001000001000001000001000001000",
                        ":": "000000010000000000010000000000000000",
                        ";": "000000010000000000010000100000000000",
                        "\"": "010100010100000000000000000000000000",
                        "<": "000000000110011000000110000000000000",
                        ">": "000000011000000110011000000000000000",
                        "~": "000000011010010110000000000000000000",
                        "`": "010000001000000000000000000000000000"
                    };
                //END

                //AUDIO CHANELS AND FREQs *************************
                    var gCHANNELS = {};
                    var gNOTES_FREQUENCIES = {
                        "-" : 0,
                        "A1" : 55,
                        "A#1" : 58.27,
                        "Bb1" : 58.27,
                        "B1" : 61.74,
                        "C2" : 65.41,
                        "C#2" : 69.3,
                        "Db2" : 69.3,
                        "D2" : 73.42,
                        "D#2" : 77.78,
                        "Eb2" : 77.78,
                        "E2" : 82.41,
                        "F2" : 87.31,
                        "F#2" : 92.5,
                        "Gb2" : 92.5,
                        "G2" : 98,
                        "G#2" : 103.83,
                        "Ab2" : 103.83,
                        "A2" : 110,
                        "A#2" : 116.54,
                        "Bb2" : 116.54,
                        "B2" : 123.47,
                        "C3" : 130.81,
                        "C#3" : 138.59,
                        "Db3" : 138.59,
                        "D3" : 146.83,
                        "D#3" : 155.56,
                        "Eb3" : 155.56,
                        "E3" : 164.81,
                        "F3" : 174.61,
                        "F#3" : 185,
                        "Gb3" : 185,
                        "G3" : 196,
                        "G#3" : 207.65,
                        "Ab3" : 207.65,
                        "A3" : 220,
                        "A#3" : 233.08,
                        "Bb3" : 233.08,
                        "B3" : 246.94,
                        "C4" : 261.63,
                        "C#4" : 277.18,
                        "Db4" : 277.18,
                        "D4" : 293.66,
                        "D#4" : 311.13,
                        "Eb4" : 311.13,
                        "E4" : 329.63,
                        "F4" : 349.23,
                        "F#4" : 369.99,
                        "Gb4" : 369.99,
                        "G4" : 392,
                        "G#4" : 415.3,
                        "Ab4" : 415.3,
                        "A4" : 440,
                        "A#4" : 466.16,
                        "Bb4" : 466.16,
                        "B4" : 493.88,
                        "C5" : 523.25,
                        "C#5" : 554.37,
                        "Db5" : 554.37,
                        "D5" : 587.33,
                        "D#5" : 622.25,
                        "Eb5" : 622.25,
                        "E5" : 659.25,
                        "F5" : 698.46,
                        "F#5" : 739.99,
                        "Gb5" : 739.99,
                        "G5" : 783.99,
                        "G#5" : 830.61,
                        "Ab5" : 830.61,
                        "A5" : 880,
                        "A#5" : 932.33,
                        "Bb5" : 932.33,
                        "B5" : 987.77,
                        "C6" : 1046.5,
                        "C#6" : 1108.73,
                        "Db6" : 1108.73,
                        "D6" : 1174.66,
                        "D#6" : 1244.51,
                        "Eb6" : 1244.51,
                        "E6" : 1318.51,
                        "F6" : 1396.91,
                        "F#6" : 1479.98,
                        "Gb6" : 1479.98,
                        "G6" : 1567.98,
                        "G#6" : 1661.22,
                        "Ab6" : 1661.22,
                        "A6" : 1760,
                        "A#6" : 1864.66,
                        "Bb6" : 1864.66,
                        "B6" : 1975.53,
                        "C7" : 2093,
                        "C#7" : 2217.46,
                        "Db7" : 2217.46,
                        "D7" : 2349.32,
                        "D#7" : 2489.02,
                        "Eb7" : 2489.02,
                        "E7" : 2637.02,
                        "F7" : 2793.83,
                        "F#7" : 2959.96,
                        "Gb7" : 2959.96,
                        "G7" : 3135.96,
                        "G#7" : 3322.44,
                        "Ab7" : 3322.44,
                        "A7" : 3520,
                        "A#7" : 3729.31,
                        "Bb7" : 3729.31,
                        "B7" : 3951.07
                    };
                //END

                //INTERNAL ENGINE FUNCTIONS ************************* 
                
                    var byId = function (id) { return document.getElementById(id); };

                    function attachGlobalEvents() {
                        var elem = document.body;
                        byId("geScreenCanvas").addEventListener("contextmenu",cancelEvent);
                        elem.addEventListener("keydown",handleKeyDown);
                        elem.addEventListener("keyup",handleKeyUp);
                        
                        byId("geDPad").addEventListener("touchstart",handleDPadDown);
                        byId("geDPad").addEventListener("touchmove",handleDPadDown);
                        byId("geDPad").addEventListener("touchend",handleDPadUp);

                        byId("geButtonA").addEventListener("touchstart",handleButtonDown);
                        byId("geButtonA").addEventListener("touchend",handleButtonUp);

                        byId("geButtonB").addEventListener("touchstart",handleButtonDown);
                        byId("geButtonB").addEventListener("touchend",handleButtonUp);

                        byId("geButtonMenu").addEventListener("touchstart",handleButtonDown);
                        byId("geButtonMenu").addEventListener("touchend",handleButtonUp);

                    }

                    function initGraphicsContext() {
                        gCONTEXT_2D = byId("geScreenCanvas").getContext("2d");
                    }

                    function cancelEvent(ev) {
                        if (ev.stopPropagation) {
                            ev.stopPropagation();
                        }
                        if (ev.preventDefault) {
                            ev.preventDefault();
                        }
                        ev.cancelBubble = true;
                        return false;
                    }

                    function handleKeyDown(e) {
                        var ev = e || window.event;
                        var key = ev.keyCode;
                        gKEY_DOWNS[key] = 1;
                        return cancelEvent(ev);
                    }

                    function handleKeyUp(e) {
                        var ev = e || window.event;
                        var key = ev.keyCode;
                        gKEY_UPS[key] = 1;
                        gKEY_DOWNS[key] = undefined;
                        return cancelEvent(ev);
                    }

                    function handleDPadUp(ev) {
                        gBUTTON_DOWNS['up'] = false;
                        gBUTTON_DOWNS['left'] = false;
                        gBUTTON_DOWNS['right'] = false;
                        gBUTTON_DOWNS['down'] = false;
                    }

                    function handleDPadDown(ev) {
                        var e = ev || window.event;
                        var x = e.targetTouches[0].pageX;
                        var y = e.targetTouches[0].pageY;
                        var dpadRect = document.getElementById("geDPad").getBoundingClientRect();
                        var gridW = dpadRect.width/5;
                        var gridH = dpadRect.height/5;
                        var gridX = Math.floor((x-dpadRect.x) / gridW);
                        var gridY = Math.floor((y-dpadRect.y) / gridH);

                        gBUTTON_DOWNS['up'] = gridY < 2 && gridY >= 0;
                        gBUTTON_DOWNS['left'] = gridX < 2 && gridX >= 0;
                        gBUTTON_DOWNS['right'] = gridX > 2 && gridX < 5;
                        gBUTTON_DOWNS['down'] = gridY > 2 && gridY < 5;
                        
                        cancelEvent(e);
                    }

                    function handleButtonDown(ev) {
                        var e = ev || window.event;
                        var id = e.target.id;
                        var btn = id.substring(id.indexOf("Button")+6).toLowerCase();
                        cancelEvent(e);
                        gBUTTON_DOWNS[btn] = true;
                        gBUTTON_UPS[btn] = false;
                    }

                    function handleButtonUp(ev) {
                        var e = ev || window.event;
                        var id = e.target.id;
                        var btn = id.substring(id.indexOf("Button")+6).toLowerCase();
                        cancelEvent(e);
                        gBUTTON_DOWNS[btn] = false;
                        gBUTTON_UPS[btn] = true;
                    }

                    function startGameLoop() {
                                                
                        if (typeof window.gameLoop == "function") {
                            gGAME_LOOP_INTERVAL = setInterval(function() {
                                updateTicks();
                                window.gameLoop();
                                gBUTTON_UPS = {};
                                gKEY_UPS = {};
                            },gGAME_LOOP_FREQ);
                        }    
                    }

                    function playWave(channel, notes, options) {
                        
                        options = options || {};
        
                        var volume = options.volume || 1;
                        var speed = options.speed || 1;
                        var noteDuration = 1 / speed;
                        var loop = options.loop || "off";
                        var voice = options.voice || "sine";  //sine, square, sawtooth, triangle
                        var volume = options.volume || 5;
                        var noteVolume = volume / 20;
                        var audioContext;
        
                        try {
                            gCHANNELS[channel].close();    
                        } catch (er) { }
                        
                        gCHANNELS[channel] = new AudioContext();
                        audioContext = gCHANNELS[channel];
        
                        var osc = audioContext.createOscillator();
                        var gainNode = audioContext.createGain();
                        
                        osc.frequency.value = gNOTES_FREQUENCIES[notes[0]];
                        osc.type = voice;
                        
                        for (var i = 1; i < notes.length; i += 1) {
                        
                            osc.frequency.setValueAtTime(gNOTES_FREQUENCIES[notes[i]],audioContext.currentTime + (i*noteDuration) );
                        }
                        
                        gainNode.gain.value = noteVolume;
                        gainNode.connect(audioContext.destination);
                        osc.connect(gainNode);
                        osc.start();
                        osc.stop(audioContext.currentTime + (notes.length * noteDuration));
                        osc.onended = function () {
                            osc.disconnect();
                            if (loop == "on") {
                                playWave(channel,notes,options);
                            }
                        };
                    }
        
                    function playNoise(channel, notes, options) {
                        
                        options = options || {};
                        
                        var speed = options.speed || 0.5;
                        var loop = options.loop || "off";
                        var noteDuration = 1 / speed;
                        var volume = options.volume || 5;
                        var noteVolume = volume / 20;
                        var audioContext;
        
                        var bandHz = gNOTES_FREQUENCIES[notes[0]];
        
                        try {                    
                            gCHANNELS[channel].close();
                        } catch (er) { }
                        gCHANNELS[channel] = new AudioContext();
                        audioContext = gCHANNELS[channel];
        
                        var bufferSize = audioContext.sampleRate * (noteDuration * notes.length);
                        var buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                        var data = buffer.getChannelData(0);
        
                        for (var i = 0; i < bufferSize; i+=1) {
                            data[i] = Math.random() * 2 - 1;
                        }
                        
                        var noise = audioContext.createBufferSource();
                        noise.buffer = buffer;
        
                        var bandpass = audioContext.createBiquadFilter();
                        bandpass.type = 'bandpass';
                        bandpass.frequency.value = bandHz;
        
                        var gainNode = audioContext.createGain();
                        gainNode.gain.value = noteVolume;
                        
                        for(var i = 1; i < notes.length; i += 1) {
                            bandpass.frequency.setValueAtTime(gNOTES_FREQUENCIES[notes[i]], audioContext.currentTime + (i*noteDuration));
                        }
        
                        gainNode.connect(audioContext.destination);
                        noise.connect(bandpass).connect(gainNode);
                        noise.start();
                        noise.onended = function () {
                            noise.disconnect();
                            if (loop == "on") {
                                playNoise(soundInfo);
                            }
                        };
                    }

                    function updateTicks() {

                        if (gTICK > 1200) {
                            gTICK = 0;
                            gFRAME_TICKS = [0,0,0,0,0,0,0,0,0,0];
                        }
                        gFRAME_TICKS[9] += (gTICK % 3 == 0) ? 1 : 0;
                        gFRAME_TICKS[8] += (gTICK % 5 == 0) ? 1 : 0;
                        gFRAME_TICKS[7] += (gTICK % 6 == 0) ? 1 : 0;
                        gFRAME_TICKS[6] += (gTICK % 10 == 0) ? 1 : 0
                        gFRAME_TICKS[5] += (gTICK % 12 == 0) ? 1 : 0;
                        gFRAME_TICKS[4] += (gTICK % 15 == 0) ? 1 : 0;
                        gFRAME_TICKS[3] += (gTICK % 20 == 0) ? 1 : 0;
                        gFRAME_TICKS[2] += (gTICK % 30 == 0) ? 1 : 0;
                        gFRAME_TICKS[1] += (gTICK % 60 == 0) ? 1 : 0;
                        gTICK += 1;
                    }

                    window.onload = function () {
                        attachGlobalEvents();
                        initGraphicsContext();
                        startGameLoop();
                    };

                    window.loadSprite = function loadSprite(spriteString) {
                        var items = spriteString.split(",");
                        var width = items[0];
                        var height = items[1];
                        var mask = items[2];
                        var imageData = items[3];
                        var index = 0;
                        var color = "0";
                        var cssColor = "";
                        var canvas = document.createElement("canvas");
                        canvas.width = width;
                        canvas.height = height;
                        var ctx = canvas.getContext("2d");
                        for(var y = 0; y < height; y += 1) {
                            for(var x = 0; x < width; x += 1) {
                                color = imageData[index];
                                if (color !== mask) {
                                    cssColor = gGAME_PALETTE[color];
                                    ctx.fillStyle = cssColor;
                                    ctx.fillRect(x, y,1,1);
                                }
                                index += 1;
                            }
                        }
                        var img = new Image();
                        img.src = canvas.toDataURL("image/png");
                        return img;
                    };

                    function updateTicks() {

                        if (gTICK > 1200) {
                            gTICK = 0;
                            gFRAME_TICKS = [0,0,0,0,0,0,0,0,0,0];
                        }
                        gFRAME_TICKS[9] += (gTICK % 3 == 0) ? 1 : 0;
                        gFRAME_TICKS[8] += (gTICK % 5 == 0) ? 1 : 0;
                        gFRAME_TICKS[7] += (gTICK % 6 == 0) ? 1 : 0;
                        gFRAME_TICKS[6] += (gTICK % 10 == 0) ? 1 : 0
                        gFRAME_TICKS[5] += (gTICK % 12 == 0) ? 1 : 0;
                        gFRAME_TICKS[4] += (gTICK % 15 == 0) ? 1 : 0;
                        gFRAME_TICKS[3] += (gTICK % 20 == 0) ? 1 : 0;
                        gFRAME_TICKS[2] += (gTICK % 30 == 0) ? 1 : 0;
                        gFRAME_TICKS[1] += (gTICK % 60 == 0) ? 1 : 0;
                        gTICK += 1;
                    }

                    function plotChar(px,py,char,fillStyleColor) {
                        var sprite = gGAME_FONT[char] || gGAME_FONT["?"];
                        var count = 0;
                        var dx = px;
                        var dy = py;
                        gCONTEXT_2D.fillStyle = fillStyleColor;
                        for (var i = 0; i < 36; i += 1) {
                            if (sprite[i] == "1") {
                                gCONTEXT_2D.fillRect(dx,dy,1,1);
                            }
                            dx += 1;
                            count += 1;
                            if (count == 6) {
                                dy += 1;
                                dx = px;
                                count = 0;
                            }
                        }
                    }

                //END
        
            //END
            //***********************************************************************************************



            //***********************************************************************************************
            //PUBLIC GAME ENGINE FUNCTIONS
                
                window.text = function text(colorIndex, x, y, value) {
                    var letterSize = 6;
                    var char = "";
                    var fillStyleColor =  gGAME_PALETTE[colorIndex];
                    value = String(value);
                    value = value.toLowerCase();
                    for (var i = 0; i < value.length; i += 1) {
                        char = value[i];
                        plotChar(x,y,char,fillStyleColor);
                        x += letterSize;
                    }
                };

                window.animate = function animate(array,speed) {
                    var frm = gFRAME_TICKS[speed] % array.length;
                    return array[frm];
                };

                window.sprite = function sprite (x,y,spriteName) {
                    var sprite = window.gSPRITES["sprite_" + spriteName];
                    gCONTEXT_2D.drawImage(sprite,x* gSCREEN_ZOOM,y* gSCREEN_ZOOM);
                };

                window.plot = function plot(color,x,y) {
                    gCONTEXT_2D.fillStyle = gGAME_PALETTE[color];
                    gCONTEXT_2D.fillRect(x,y,1,1);
                };

                window.rect = function rect(color,x,y,w,h) {
                    gCONTEXT_2D.fillStyle = gGAME_PALETTE[color];
                    gCONTEXT_2D.fillRect(x,y,w,h);
                };

                window.setBuffer = function (bufferIndex) {
                    if (bufferIndex == 0) {
                        gHTML_BUFFER_TARGET = "geScreenBackground";
                    } else if (bufferIndex == 1) {
                        gHTML_BUFFER_TARGET = "geScreenForeground";
                    }
                }

                window.clear = function clear() {
                    rect(0,0,0,100,100);
                };

                window.rand = function rand(max) {
                    max = max || 100;
                    return Math.floor(Math.random() * max);
                };

                window.save = function save(name,value) {
                    window.localStorage[name] = value;
                };

                window.load = function load(name) {
                    return window.localStorage[name];
                };

                window.dist = function dist(x1,y1,x2,y2) {
                    var dx = x2-x1;
                    var dy = y2-y1;
                    var ratio = (dy*dy) + (dx*dx);
                    return Math.sqrt(ratio);
                };

                window.inside = function inside(px,py, rx, ry, rw, rh) {
                    return (px > rx) && (px < (rx + rw)) && (py > ry) && (py < (ry+rh));
                };

                window.overlap = function overlap(x1,y1,w1,h1,x2,y2,w2,h2) {
                    
                    if (inside(x1,y1,x2,y2,w2,h2)) {
                        return true;
                    } else if (inside(x1+w1,y1,x2,y2,w2,h2)) {
                        return true;
                    } else if (inside(x1,y1+h1,x2,y2,w2,h2)) {
                        return true;
                    } else if (inside(x1+w1,y1+h1,x2,y2,w2,h2)) {
                        return true;
                    }
                    return false;
                };

                window.buttonDown = function buttonDown(buttonId) {
                    
                    return gBUTTON_DOWNS[buttonId] == true;
                };

                window.buttonUp = function buttonUp(buttonId) {

                    return gBUTTON_UPS[buttonId] == true;
                };

                window.keyDown = function keyDown(keyCode) {

                    return gKEY_DOWNS[keyCode] != undefined;
                };

                window.keyUp = function keyUp(keyCode) {
                    return gKEY_UPS[keyCode] != undefined;
                };
                
                window.play = function play(name) {
                    
                    var soundName = "sound_" + name;
                    var notes = gSOUNDS[soundName].notes;
                    var options = gSOUNDS[soundName].options;
                    
                    if (options.voice == "noise") {
                        playNoise(soundName, notes, options);
                    } else {
                        playWave(soundName, notes, options);
                    }
                };

                window.stop = function stop(channel) {
                    var soundName = "sound_" + channel;
                    try {
                        gCHANNELS[soundName].close();
                    } catch (er) { }
                };

            //END
            //***********************************************************************************************

        }(window));

        var px = 0;
        var py = 0;


        function gameLoop() {

            if (buttonDown('up')) {
                if (py > 0) {
                    py -= 1;
                }
            }
            if (buttonDown('down')) {
                if (py < 95) {
                    py += 1;
                }
            }

            if (buttonDown('left')) {
                if (px > 0) {
                    px -= 1;
                }
            }
            if (buttonDown('right')) {
                if (px < 95) {
                    px += 1;
                }
            }

            setBuffer(1);
            clear();
            if (buttonDown('a')) {
                text(2,15,15,"PRESSED A!");
            }
            if (buttonDown('b')) {
                text(3,15,22,"PRESSED B!");
            }
            if (buttonDown('menu')) {
                text(2,15,29,"PRESSED MENU!");
            }

            rect(3,px,py,8,8);
            text(3,0,70,"hello world");
            text(2,0,77,"hello world");
            text(1,0,84,"hello world");
            rect(1,10,10,10,10);
            rect(2,10,20,10,10);
            rect(3,10,30,10,10);
            
        }

    </script>

</body>
</html>